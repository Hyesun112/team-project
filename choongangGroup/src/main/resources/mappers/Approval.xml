<?xml version="1.0" encoding="UTF-8"?>

<!-- ======= mapper 기본설정 ======= -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체 내에서 유일해야 한다.) ==== -->
<mapper namespace="com.oracle.choongangGroup.hs.approval.ApprovalMapper">

	<!-- =====================결재 리스트 불러오기===================== -->
	<select id="hsApprWaitList" parameterType="String" resultType="Approval">
		<![CDATA[
		SELECT *
		FROM
		(
			SELECT rownum rn, a.*
			FROM
			(
				select * from approval
				where #{userid} = any(mid_approver, fin_approver)
				and approval_status <= 1 
				order by approval_no desc
			) a
		)
		where rn between 1 and 3
		]]>
	</select>
	
	<select id="hsApprProcessList" parameterType="String" resultType="Approval">
		<![CDATA[
		SELECT *
		FROM
		(
			SELECT rownum rn, a.*
			FROM
			(
				select * from approval
				where userid = #{userid}
				and approval_status <= 1
				order by approval_no desc
			) a
		)
		where rn between 1 and 3
		]]>
	</select>
	
	<select id="hsApprfinishList" parameterType="String" resultType="Approval">
		<![CDATA[
		SELECT *
		FROM
		(
			SELECT rownum rn, a.*
			FROM
			(
				select * from approval
				where #{userid} = any(mid_approver, fin_approver, userid)
				and approval_status >= 2
				order by approval_no desc
			) a
		)
		where rn between 1 and 3
		]]> 
	</select>
	
	<!-- =====================결재 Cnt===================== -->
	<select id="waitTotal" parameterType="String" resultType="int">
			<![CDATA[
			select count(*) from approval
			where #{userid} = any(mid_approver, fin_approver)
			and approval_status <= 1  
			]]>
	</select>
	
	<select id="processTotal" parameterType="String" resultType="int">
			<![CDATA[
			select count(*) from approval
			where userid = #{userid}
			and approval_status <= 1 
			]]>
	</select>
	
	<select id="finishTotal" parameterType="String" resultType="int">
			<![CDATA[
			select count(*) from approval
			where #{userid} = any(mid_approver, fin_approver, userid)
			and approval_status >= 2
			]]>
	</select>
	
	
</mapper>